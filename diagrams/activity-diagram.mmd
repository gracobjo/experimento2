graph TD
    Start([ðŸš€ Inicio]) --> Login{ðŸ” Â¿Usuario autenticado?}
    
    Login -->|No| LoginForm[ðŸ“ Formulario de Login]
    LoginForm --> Validate{âœ… Â¿Credenciales vÃ¡lidas?}
    Validate -->|No| LoginForm
    Validate -->|SÃ­| Dashboard[ðŸ“Š Dashboard]
    
    Login -->|SÃ­| Dashboard
    
    Dashboard --> Menu{ðŸŽ¯ Â¿QuÃ© acciÃ³n realizar?}
    
    %% Flujo de Casos
    Menu -->|Crear Caso| CreateCase[ðŸ“ Crear Nuevo Caso]
    CreateCase --> CaseForm[ðŸ“‹ Formulario de Caso]
    CaseForm --> ValidateCase{âœ… Â¿Datos vÃ¡lidos?}
    ValidateCase -->|No| CaseForm
    ValidateCase -->|SÃ­| SaveCase[ðŸ’¾ Guardar Caso]
    SaveCase --> CaseCreated[âœ… Caso Creado]
    CaseCreated --> Dashboard
    
    %% Flujo de FacturaciÃ³n
    Menu -->|Crear Factura| CreateInvoice[ðŸ“„ Crear Factura]
    CreateInvoice --> InvoiceForm[ðŸ“ Formulario de Factura]
    InvoiceForm --> ValidateInvoice{âœ… Â¿Datos vÃ¡lidos?}
    ValidateInvoice -->|No| InvoiceForm
    ValidateInvoice -->|SÃ­| GenerateInvoice[ðŸ”„ Generar Factura]
    GenerateInvoice --> QRCode[ðŸ“± Generar QR]
    QRCode --> PDF[ðŸ“„ Generar PDF]
    PDF --> SignInvoice{ðŸ“ Â¿Firmar Factura?}
    SignInvoice -->|SÃ­| DigitalSignature[ðŸ” Firma Digital]
    DigitalSignature --> SignedInvoice[âœ… Factura Firmada]
    SignInvoice -->|No| InvoiceComplete[âœ… Factura Completa]
    SignedInvoice --> InvoiceComplete
    InvoiceComplete --> Dashboard
    
    %% Flujo de Citas
    Menu -->|Agendar Cita| ScheduleAppointment[ðŸ“… Agendar Cita]
    ScheduleAppointment --> AppointmentForm[ðŸ“‹ Formulario de Cita]
    AppointmentForm --> ValidateAppointment{âœ… Â¿Datos vÃ¡lidos?}
    ValidateAppointment -->|No| AppointmentForm
    ValidateAppointment -->|SÃ­| SaveAppointment[ðŸ’¾ Guardar Cita]
    SaveAppointment --> SendConfirmation[ðŸ“§ Enviar ConfirmaciÃ³n]
    SendConfirmation --> AppointmentScheduled[âœ… Cita Agendada]
    AppointmentScheduled --> Dashboard
    
    %% Flujo de Chatbot
    Menu -->|Asistente Virtual| OpenChatbot[ðŸ¤– Abrir Chatbot]
    OpenChatbot --> ChatInterface[ðŸ’¬ Interfaz de Chat]
    ChatInterface --> UserQuestion[â“ Pregunta del Usuario]
    UserQuestion --> ProcessNLP[ðŸ§  Procesar con NLP]
    ProcessNLP --> IntentDetection[ðŸŽ¯ Detectar IntenciÃ³n]
    IntentDetection --> EntityExtraction[ðŸ·ï¸ Extraer Entidades]
    EntityExtraction --> GenerateResponse[ðŸ’­ Generar Respuesta]
    GenerateResponse --> BackendQuery{ðŸ”— Â¿Necesita datos del backend?}
    BackendQuery -->|SÃ­| FetchData[ðŸ“Š Obtener Datos]
    FetchData --> GenerateResponse
    BackendQuery -->|No| SendResponse[ðŸ“¤ Enviar Respuesta]
    SendResponse --> ChatInterface
    ChatInterface --> ContinueChat{ðŸ”„ Â¿Continuar chat?}
    ContinueChat -->|SÃ­| UserQuestion
    ContinueChat -->|No| CloseChatbot[âŒ Cerrar Chatbot]
    CloseChatbot --> Dashboard
    
    %% Flujo de Reportes
    Menu -->|Ver Reportes| ViewReports[ðŸ“ˆ Ver Reportes]
    ViewReports --> SelectReport{ðŸ“Š Â¿QuÃ© reporte?}
    SelectReport -->|EstadÃ­sticas| GenerateStats[ðŸ“Š Generar EstadÃ­sticas]
    SelectReport -->|FacturaciÃ³n| GenerateInvoiceReport[ðŸ“„ Reporte FacturaciÃ³n]
    SelectReport -->|Casos| GenerateCaseReport[ðŸ“ Reporte Casos]
    GenerateStats --> DisplayReport[ðŸ“‹ Mostrar Reporte]
    GenerateInvoiceReport --> DisplayReport
    GenerateCaseReport --> DisplayReport
    DisplayReport --> ExportReport{ðŸ“¤ Â¿Exportar?}
    ExportReport -->|SÃ­| DownloadReport[ðŸ“¥ Descargar Reporte]
    ExportReport -->|No| ReportComplete[âœ… Reporte Completo]
    DownloadReport --> ReportComplete
    ReportComplete --> Dashboard
    
    %% Flujo de ConfiguraciÃ³n
    Menu -->|ConfiguraciÃ³n| OpenSettings[âš™ï¸ Abrir ConfiguraciÃ³n]
    OpenSettings --> SettingsMenu{ðŸ”§ Â¿QuÃ© configurar?}
    SettingsMenu -->|ParÃ¡metros| ManageParams[ðŸ“ Gestionar ParÃ¡metros]
    SettingsMenu -->|Layout| ConfigureLayout[ðŸŽ¨ Configurar Layout]
    SettingsMenu -->|Usuarios| ManageUsers[ðŸ‘¥ Gestionar Usuarios]
    ManageParams --> SaveSettings[ðŸ’¾ Guardar ConfiguraciÃ³n]
    ConfigureLayout --> SaveSettings
    ManageUsers --> SaveSettings
    SaveSettings --> SettingsSaved[âœ… ConfiguraciÃ³n Guardada]
    SettingsSaved --> Dashboard
    
    %% Flujo de Logout
    Menu -->|Cerrar SesiÃ³n| Logout[ðŸšª Cerrar SesiÃ³n]
    Logout --> ClearSession[ðŸ—‘ï¸ Limpiar SesiÃ³n]
    ClearSession --> Redirect[ðŸ”„ Redirigir a Login]
    Redirect --> Login
    
    %% Estilos
    classDef startEnd fill:#ffebee,stroke:#c62828,stroke-width:3px
    classDef process fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef action fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef database fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class Start,Login,Validate,ValidateCase,ValidateInvoice,SignInvoice,ValidateAppointment,BackendQuery,ContinueChat,SelectReport,ExportReport,SettingsMenu,LoginForm,Dashboard,CreateCase,CaseForm,SaveCase,CaseCreated,CreateInvoice,InvoiceForm,GenerateInvoice,QRCode,PDF,DigitalSignature,SignedInvoice,InvoiceComplete,ScheduleAppointment,AppointmentForm,SaveAppointment,SendConfirmation,AppointmentScheduled,OpenChatbot,ChatInterface,UserQuestion,ProcessNLP,IntentDetection,EntityExtraction,GenerateResponse,FetchData,SendResponse,CloseChatbot,ViewReports,GenerateStats,GenerateInvoiceReport,GenerateCaseReport,DisplayReport,DownloadReport,ReportComplete,OpenSettings,ManageParams,ConfigureLayout,ManageUsers,SaveSettings,SettingsSaved,Logout,ClearSession,Redirect startEnd 